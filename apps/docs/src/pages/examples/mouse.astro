---
import LayoutExample from '../../layouts/LayoutExample.astro';
---

<LayoutExample name='mouse'>
  <script>
    import { WGSLCanvas } from '@wgsl-canvas/core';
    import shaderFragment from '../../shaders/mouse.wgsl?raw';

    async function main() {
      if (!WGSLCanvas.isSupported()) {
        alert('WebGPU is not supported in this browser.');
        return;
      }

      const canvas = document.getElementById('canvas');
      if (!canvas || !(canvas instanceof HTMLCanvasElement)) return;

      const wgslCanvas = new WGSLCanvas({ canvas });
      await wgslCanvas.init();

      wgslCanvas.uniformsKeys = ["mouse", "time"];
      wgslCanvas.uniforms.mouse = [0.5, 0.5];
      wgslCanvas.uniforms.time = 0.0;

      wgslCanvas.shaderFragment = shaderFragment;

      canvas.addEventListener('pointermove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        wgslCanvas.uniforms.mouse = [x, y];
      });

      const frame: FrameRequestCallback = (timeMs) => {
        const time = timeMs * 0.001;
        wgslCanvas.uniforms.time = time;
        wgslCanvas.render();

        requestAnimationFrame(frame);
      };
      requestAnimationFrame(frame);
    }

    void main();
  </script>
</LayoutExample>
